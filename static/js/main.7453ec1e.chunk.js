(this["webpackJsonpmy-social-network"]=this["webpackJsonpmy-social-network"]||[]).push([[0],{17:function(e,t,s){e.exports={users:"Users_users__1Jch4",usersItem:"Users_usersItem__3U_gj",image:"Users_image__2ZMB_",description:"Users_description__E4-wM",userName:"Users_userName__3hMjh",buttonsBlock:"Users_buttonsBlock__3hktt",showPageBtnsBlock:"Users_showPageBtnsBlock__3rpn5",showPageBtn:"Users_showPageBtn__23hGE",active:"Users_active__2uOVI"}},19:function(e,t,s){e.exports={posts:"MyPosts_posts__1u7Sc",addPosts:"MyPosts_addPosts__3I7gb",inputBlock:"MyPosts_inputBlock__2wPeX",textareaBlock:"MyPosts_textareaBlock__D7D-v",postsContainer:"MyPosts_postsContainer__1Ev9v",postsItem:"MyPosts_postsItem__3h9o-",postsItemContent:"MyPosts_postsItemContent__3It6t",postTitle:"MyPosts_postTitle__exwRp",btnsBlock:"MyPosts_btnsBlock__1NeS4"}},22:function(e,t,s){e.exports={menu:"Menu_menu__3mnQ3",title:"Menu_title__3oSS_",navigation:"Menu_navigation__1HJAm",navLink:"Menu_navLink__3VQcG"}},27:function(e,t,s){e.exports={dialogsItem:"Dialogs_dialogsItem__28l7C",image:"Dialogs_image__18QrX",description:"Dialogs_description__33cqp",userName:"Dialogs_userName__2HBoh",hasNewMessages:"Dialogs_hasNewMessages__2eJc9"}},34:function(e,t,s){e.exports={form:"Login_form__1JmN2",error:"Login_error__tgvln"}},38:function(e,t,s){e.exports={profile:"Profile_profile__eq8ZB",profileImage:"Profile_profileImage__2TuwA"}},39:function(e,t,s){e.exports={header:"Header_header__16zfk",userPhoto:"Header_userPhoto__3zw6n"}},5:function(e,t,s){e.exports={messages:"Messages_messages__3w2wZ",messagesBlock:"Messages_messagesBlock__1ZzGW",messageItem:"Messages_messageItem__3-4IE",nav:"Messages_nav__1cko9",active:"Messages_active__SFPye",spam:"Messages_spam__3PN9r",authorized:"Messages_authorized__12Xjl",image:"Messages_image__1kATD",text:"Messages_text__FLDaI",name:"Messages_name__3HGqR",body:"Messages_body__2Mx3s",date:"Messages_date__2Ik-N",sendField:"Messages_sendField__3oXFf",viewed:"Messages_viewed__ZJ5CP",showPrevMessages:"Messages_showPrevMessages__1_0eh",showNextMessages:"Messages_showNextMessages___oIT_",btnsBlock:"Messages_btnsBlock__VkCBi"}},58:function(e,t,s){},59:function(e,t,s){},87:function(e,t,s){"use strict";s.r(t);var n=s(1),a=s.n(n),o=s(31),c=s.n(o),r=(s(58),s(2)),i=s(6),u=s(7),l=s(10),p=s(9),d=(s(59),s(18)),j=s(22),g=s.n(j),h=s(12),b=s(0),m=function(e){var t=e.newMessagesCount;Object(d.a)(e,["newMessagesCount"]);return Object(b.jsxs)("div",{className:g.a.menu+" block",children:[Object(b.jsx)("h3",{className:g.a.title,children:"Menu"}),Object(b.jsxs)("nav",{className:g.a.navigation,children:[Object(b.jsx)(h.b,{className:g.a.navLink,to:"/profile/me",children:"Home"}),Object(b.jsx)(h.b,{className:g.a.navLink,to:"/posts",children:"Post"}),Object(b.jsx)(h.b,{className:g.a.navLink,to:"/users",children:"Users"}),Object(b.jsx)(h.b,{className:g.a.navLink,to:"/follow",children:"Follow"}),Object(b.jsxs)(h.b,{className:g.a.navLink,to:"/dialogs",children:["Dialogs",t?Object(b.jsx)("small",{children:t}):null]})]})]})},O=s(3),f=s(4),x=s(16),v=s(20),w=s.n(v),C=s(24),_=s(49),k=s.n(_).a.create({baseURL:"https://social-network.samuraijs.com/api/1.0",withCredentials:!0,headers:{"API-KEY":"aadfdf1c-f219-4c40-a41b-811f24be2490"}}),N={getUsers:function(){var e=Object(C.a)(w.a.mark((function e(t,s){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.get("/users?count=".concat(t,"&page=").concat(s));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,s){return e.apply(this,arguments)}}(),getFollowing:function(){var e=Object(C.a)(w.a.mark((function e(){var t,s,n,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=100,s=0,n=[],e.next=5,k.get("/users").then((function(e){s=Math.ceil(e.data.totalCount/t)}));case 5:a=1;case 6:if(!(a<=s)){e.next=12;break}return e.next=9,k.get("/users?count=".concat(t,"&page=").concat(a)).then((function(e){var t=e.data.items;n=[].concat(Object(x.a)(n),Object(x.a)(t.filter((function(e){return e.followed}))))}));case 9:a++,e.next=6;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},M=function(){return k.get("/auth/me")},S=function(e){return k.post("/auth/login",e)},y=function(){return k.delete("/auth/login")},E=function(e){return k.get("/profile/".concat(e))},T=function(e){return k.get("/profile/status/".concat(e))},P=function(e){return k.put("/profile",{profile:e})},I={isLoggedIn:!1,loginName:null,me:{id:0,photo:null},followings:[]},D=function(e){return{type:"login/AUTHORIZED",loginName:e}},U=function(e){return{type:"login/SET-LOGIN-IN",value:e}},A=function(e){return{type:"me/SET-ID",id:e}},L=function(e){return function(t){S(e).then((function(e){0===e.data.resultCode&&(t(U(!0)),t(A(e.data.data.id)))}))}},B=s(17),F=s.n(B),G=function(e){return k.get("/follow/".concat(e))},R=function(e){return k.post("/follow/".concat(e))},W=function(e){return k.delete("/follow/".concat(e))},z={users:[],totalCount:0,currentPageNumber:1},H=function(e,t){return{type:"SET-FOLLOW",isFollow:t,userID:e}},V=function(e){return function(t){G(e).then((function(e){console.log(e)}))}},J={profile:{aboutMe:"",userId:0,lookingForAJob:!1,lookingForAJobDescription:"",fullName:"",contacts:{github:"",vk:"",facebook:"",instagram:"",twitter:"",website:"",youtube:"",mainLink:""},photos:{small:null,large:null}}},Z=function(e){return function(t){E(e).then((function(e){t({type:"SET-USER-PROFILE",userProfile:e.data})}))}},$=function(e){return function(t){T(e).then((function(e){t({type:"SET-USER-STATUS",userStatus:e.data})}))}},X=function(){return k.get("/dialogs")},q=function(e){return k.put("/dialogs/".concat(e))},K=function(e,t,s){return k.get("dialogs/".concat(e,"/messages?count=").concat(t,"&page=").concat(s))},Q=function(e,t){return k.post("dialogs/".concat(e,"/messages"),{body:t})},Y=function(e){return k.get("dialogs/messages/".concat(e,"/viewed")).then((function(e){return e.data}))},ee=function(e){return k.delete("dialogs/messages/".concat(e))},te=function(e){return k.post("dialogs/messages/".concat(e,"/spam"))},se=function(){return k.get("dialogs/messages/new/count")},ne=function(e,t){return console.log("dialogs/".concat(e,"/messages/new?newerThen=").concat(t)),k.get("dialogs/".concat(e,"/messages/new?newerThen=").concat(t))},ae=function(e){return k.put("dialogs/messages/".concat(e,"/restore"))},oe={dialogs:[],totalCountDialogs:1,messages:{items:[],totalCountMessages:1,userID:0,newMessagesCount:0},sectionSelected:"messages",spam:[]},ce=function(e){return{type:"messages/SET-TOTAL-COUNT",count:e}},re=function(e){return{type:"messages/REMOVE=MESSAGE",messageID:e}},ie=function(e){return function(t){q(e).then((function(e){return e}))}},ue=function(e,t,s){return function(){var n=Object(C.a)(w.a.mark((function n(a){return w.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a({type:"messages/SET-USER-ID",ID:e}),n.next=3,K(e,t,s).then((function(e){a(ce(e.data.totalCount)),a({type:"messages/SET-MESSAGES",messages:e.data.items})}));case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},le=function(){return function(e){se().then((function(t){e({type:"messages/SET-NEW-MESSAGES-COUNT",count:t.data})}))}},pe=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(){return Object(i.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"shouldComponentUpdate",value:function(e){return this.props.isFollow!==e.isFollow}},{key:"onClickHandler",value:function(e){this.props.getUserProfile(e),this.props.getUserStatus(e)}},{key:"follow",value:function(){this.props.follow(this.props.id),console.log(this.props.followings)}},{key:"unfollow",value:function(){this.props.unfollow(this.props.id)}},{key:"writeMessage",value:function(){this.props.startOrRefreshDialogs(this.props.id),this.props.getMessages(this.props.id,20,1)}},{key:"render",value:function(){var e=this;return Object(b.jsxs)("div",{className:"block ".concat(F.a.usersItem),children:[Object(b.jsx)("div",{className:F.a.image,children:Object(b.jsx)(h.b,{onClick:function(){e.onClickHandler(e.props.id)},title:this.props.name,to:"/profile/".concat(this.props.id),children:Object(b.jsx)("img",{src:this.props.photoUrl||"https://vjoy.cc/wp-content/uploads/2020/12/1133ea1de4e69bd760056f2c04e90920.png"})})}),Object(b.jsxs)("div",{className:F.a.description,children:[Object(b.jsx)(h.b,{onClick:function(){e.onClickHandler(e.props.id)},className:F.a.userName,title:this.props.name,to:"/profile/".concat(this.props.id),children:this.props.name}),Object(b.jsxs)("div",{className:F.a.buttonsBlock,children:[this.props.isFollow?Object(b.jsx)("button",{className:F.a.followBtn,onClick:this.unfollow.bind(this),children:"Unfollow"}):Object(b.jsx)("button",{className:F.a.followBtn,onClick:this.follow.bind(this),children:"Follow"}),Object(b.jsx)(h.b,{title:"",to:"/dialogs/messages/".concat(this.props.name),onClick:this.writeMessage.bind(this),children:"Message"})]})]})]})}}]),s}(a.a.Component),de={getUserProfile:Z,getUserStatus:$,checkFollow:V,follow:function(e){return function(t){R(e).then((function(s){0===s.data.resultCode&&t(H(e,!0))}))}},unfollow:function(e){return function(t){W(e).then((function(s){0===s.data.resultCode&&t(H(e,!1))}))}},startOrRefreshDialogs:ie,getMessages:ue},je=Object(f.b)((function(e){return{followings:e.auth.followings}}),de)(pe),ge=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(){return Object(i.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"componentWillMount",value:function(){this.props.getFollowing()}},{key:"shouldComponentUpdate",value:function(e,t,s){return this.props.followings!==e.followings}},{key:"componentWillUpdate",value:function(e,t,s){this.props.getFollowing()}},{key:"render",value:function(){return Object(b.jsx)("div",{children:this.props.followings.map((function(e){return Object(b.jsx)(je,{id:e.id,name:e.name,photoUrl:e.photos.small,isFollow:e.followed},e.id)}))})}}]),s}(a.a.Component),he={addFollowing:function(e,t){return function(s){N.getUsers(e,t).then((function(e){s({type:"me/ADD-FOLLOWINGS",user:e.data.items})}))}},getFollowing:function(){return function(e){N.getFollowing().then((function(t){e({type:"me/GET-FOLLOWING",users:t})}))}}},be=Object(f.b)((function(e){return{followings:e.auth.followings,totalCount:e.usersPage.totalCount}}),he)(ge),me=s(19),Oe=s.n(me),fe=s(11),xe=function(e){var t=e.value,s=e.onChangeCallBack,a=e.editMode,o=(Object(d.a)(e,["value","onChangeCallBack","editMode"]),Object(n.useState)(!1)),c=Object(fe.a)(o,2),r=c[0],i=c[1];return Object(b.jsx)(b.Fragment,{children:a?Object(b.jsx)("div",{className:r?"error":"",children:Object(b.jsx)("input",{type:"text",value:t,onChange:function(e){s(e.currentTarget.value),e.currentTarget.value.trim()?i(!1):i(!0)}})}):Object(b.jsx)("span",{children:t})})},ve=function(e){var t=e.id,s=e.title,a=e.text,o=Object(d.a)(e,["id","title","text"]),c=Object(n.useState)(!1),r=Object(fe.a)(c,2),i=r[0],u=r[1];return Object(b.jsxs)("div",{className:"block "+Oe.a.postsItem,children:[Object(b.jsxs)("div",{className:Oe.a.postsItemContent,children:[Object(b.jsx)("h6",{className:Oe.a.postTitle,children:Object(b.jsx)(xe,{editMode:i,value:s,onChangeCallBack:function(e){o.changeTitleCallBack(t,e)}})}),Object(b.jsx)("div",{children:Object(b.jsx)(xe,{editMode:i,value:a,onChangeCallBack:function(e){o.changeTextCallBack(t,e)}})})]}),Object(b.jsxs)("div",{className:Oe.a.btnsBlock,children:[Object(b.jsx)("button",{onClick:function(){s.trim()&&a.trim()&&u(!i)},children:"Edit post"}),Object(b.jsx)("button",{className:Oe.a.deletePost,onClick:function(){o.removePostCallBack(t)},children:"X"})]})]},t)},we=function(e){var t=e.error&&e.error.some((function(e){return"Text error!"===e}))?e.className+" error":e.className;return Object(b.jsxs)("div",{className:t,children:[Object(b.jsx)("textarea",{onKeyPress:function(t){"Enter"===t.key&&(t.preventDefault(),e.addPost())},onChange:function(t){e.onChangeTextCallBack(t.currentTarget.value),e.error&&e.setError&&e.setError(e.error.filter((function(e){return"Text error!"!==e})))},value:e.text,placeholder:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u043e\u0441\u0442\u0430"}),Object(b.jsx)("span",{children:e.error&&e.error.some((function(e){return"Text error!"===e}))?"\u041f\u043e\u043b\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c":""})]})},Ce=function(e){var t=e.error.some((function(e){return"Title error!"===e}))?e.className+" error":e.className;return Object(b.jsxs)("div",{className:t,children:[Object(b.jsx)("input",{onKeyPress:function(t){"Enter"===t.key&&(t.preventDefault(),e.addPost())},onChange:function(t){e.onChangeTitleCallBack(t.currentTarget.value),e.setError(e.error.filter((function(e){return"Title error!"!==e})))},value:e.title,placeholder:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u043f\u043e\u0441\u0442\u0430...",type:"text"}),Object(b.jsx)("span",{children:e.error.some((function(e){return"Title error!"===e}))?"\u041f\u043e\u043b\u0435 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c":""})]})},_e=function(e){var t=Object(n.useState)(""),s=Object(fe.a)(t,2),a=s[0],o=s[1],c=Object(n.useState)(""),r=Object(fe.a)(c,2),i=r[0],u=r[1],l=Object(n.useState)([]),p=Object(fe.a)(l,2),d=p[0],j=p[1],g=function(e){if("string"===typeof e){var t=Object(x.a)(d);t.push(e),j(t)}else j(e)},h=function(){if(a&&i)e.addPostCallBack(i,a),j([]);else{var t=[];i||t.push("Title error!"),a||t.push("Text error!"),j(t)}};return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(Ce,{error:d,addPost:h,title:i,onChangeTitleCallBack:function(e){u(e)},className:Oe.a.inputBlock,setError:g}),Object(b.jsx)(we,{error:d,addPost:h,onChangeTextCallBack:function(e){o(e)},text:a,className:Oe.a.textareaBlock,setError:g}),Object(b.jsx)("button",{onClick:h,children:"Add post"})]})},ke=function(e){return Object(b.jsxs)("div",{children:[Object(b.jsx)("div",{className:"block "+Oe.a.addPosts,children:Object(b.jsx)(_e,{addPostCallBack:e.addPost})}),Object(b.jsx)("div",{className:Oe.a.postsContainer,children:e.posts.map((function(t){return Object(b.jsx)(ve,{changeTitleCallBack:e.changeTitle,changeTextCallBack:e.changeText,removePostCallBack:e.removePost,id:t.id,title:t.title,text:t.text},t.id)}))})]})},Ne=[{id:4,text:"text 4",title:"post 4"},{id:3,text:"text 3",title:"post 3"},{id:2,text:"text 2",title:"post 2"},{id:1,text:"text 1",title:"post 1"}],Me=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(){return Object(i.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"render",value:function(){return Object(b.jsx)(ke,Object(r.a)({},this.props))}}]),s}(a.a.Component),Se=Object(f.b)((function(e){return{posts:e.posts}}),(function(e){return{addPost:function(t,s){e(function(e,t){return{type:"ADD-POST",title:e,text:t}}(t,s))},removePost:function(t){e(function(e){return{type:"REMOVE-POST",id:e}}(t))},changeTitle:function(t,s){e(function(e,t){return{type:"CHANGE-TITLE",title:t,id:e}}(t,s))},changeText:function(t,s){e(function(e,t){return{type:"CHANGE-TEXT",text:t,id:e}}(t,s))}}}))(Me),ye=function(e){var t=e.users,s=e.totalCount,n=e.currentPageNumber,a=e.showUsersCount,o=e.getUsers,c=(e.getUserProfile,e.getUserStatus,e.checkFollow,Object(d.a)(e,["users","totalCount","currentPageNumber","showUsersCount","getUsers","getUserProfile","getUserStatus","checkFollow"]),Math.ceil(s/a)),r=[],i=function(e,t){for(var s=function(e){var t=e===n?"".concat(F.a.showPageBtn," ").concat(F.a.active):"".concat(F.a.showPageBtn);r.push(Object(b.jsx)("button",{className:t,onClick:function(){u(e)},children:e},e+" showPageNumber"))},a=e;a<=t;a++)s(a)};n<6?i(1,10):n>5&&n<c-5?i(n-4,n+5):n>=c-5&&i(c-9,c);var u=function(e){o(a,e)};return Object(b.jsxs)("div",{children:[t.map((function(e){return Object(b.jsx)(je,{id:e.id,name:e.name,photoUrl:e.photos.small,isFollow:e.followed},e.id)})),Object(b.jsx)("div",{className:F.a.showPageBtnsBlock,children:r})]})},Ee=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(){return Object(i.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"componentDidMount",value:function(){this.props.getUsers(this.props.showUsersCount,this.props.currentPageNumber)}},{key:"render",value:function(){return Object(b.jsx)(ye,Object(r.a)({},this.props))}}]),s}(a.a.Component),Te={getUsers:function(e,t){return function(s){null===e&&(e=10),N.getUsers(e,t).then((function(e){s({type:"GET-USERS",users:e.data.items}),s({type:"GET-TOTAL-COUNT",totalCount:e.data.totalCount}),s({type:"SET-PAGE-NUMBER",currentPageNumber:t})}))}},getUserProfile:Z,getUserStatus:$,checkFollow:V},Pe=Object(f.b)((function(e){return{users:e.usersPage.users,totalCount:e.usersPage.totalCount,currentPageNumber:e.usersPage.currentPageNumber}}),Te)(Ee),Ie=s(38),De=s.n(Ie),Ue=function(e){var t=e.profile,s=e.status;Object(d.a)(e,["profile","status"]);return t?Object(b.jsxs)("div",{className:De.a.profile,children:[Object(b.jsx)("div",{className:De.a.profileImage,children:Object(b.jsx)("img",{src:t.photos.large||"https://vjoy.cc/wp-content/uploads/2020/12/1133ea1de4e69bd760056f2c04e90920.png"})}),Object(b.jsxs)("div",{children:[Object(b.jsx)("h3",{children:t.fullName}),Object(b.jsx)("div",{children:s}),Object(b.jsx)("div",{children:t.aboutMe}),Object(b.jsx)("div",{children:t.lookingForAJob?t.lookingForAJobDescription:null}),Object(b.jsxs)("div",{children:[Object(b.jsx)("h4",{children:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u044b:"}),Object(b.jsxs)("ul",{children:[t.contacts.github?Object(b.jsxs)("li",{children:["github: $",t.contacts.github]}):null,t.contacts.vk?Object(b.jsxs)("li",{children:["vk: $",t.contacts.vk]}):null,t.contacts.facebook?Object(b.jsxs)("li",{children:["facebook: $",t.contacts.facebook]}):null,t.contacts.instagram?Object(b.jsxs)("li",{children:["instagram: $",t.contacts.instagram]}):null,t.contacts.twitter?Object(b.jsxs)("li",{children:["twitter: $",t.contacts.twitter]}):null,t.contacts.website?Object(b.jsxs)("li",{children:["website: $",t.contacts.website]}):null,t.contacts.youtube?Object(b.jsxs)("li",{children:["youtube: $",t.contacts.youtube]}):null,t.contacts.mainLink?Object(b.jsxs)("li",{children:["mainLink: $",t.contacts.mainLink]}):null]})]})]})]}):Object(b.jsx)("div",{children:Object(b.jsx)("h3",{children:void 0})})},Ae={getUserProfile:Z,updateUserProfile:function(e){return function(t){P(e).then((function(e){console.log(e)}))}}},Le=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(){return Object(i.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"componentWillMount",value:function(){this.props.userID&&this.props.getUserProfile(this.props.userID)}},{key:"render",value:function(){return Object(b.jsx)(Ue,Object(r.a)({},this.props))}}]),s}(a.a.Component),Be=Object(f.b)((function(e){return{profile:e.profilePage.profile,status:e.profilePage.status}}),Ae)(Le),Fe=function(e){var t=e.id;return Object(b.jsx)("div",{children:Object(b.jsx)(Be,{userID:t})})},Ge=s(39),Re=s.n(Ge),We=function(e){var t=null!==e.photo?e.photo:"https://vjoy.cc/wp-content/uploads/2020/12/1133ea1de4e69bd760056f2c04e90920.png";return Object(b.jsxs)("header",{className:Re.a.header,children:[Object(b.jsx)("div",{className:Re.a.userPhoto,children:e.isLoggedIn?Object(b.jsx)("img",{src:t}):null}),null!==e.loginName?Object(b.jsxs)("button",{onClick:function(){return e.logout()},children:[" ",e.loginName," "]}):Object(b.jsx)("button",{children:"Login"})]})},ze=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(){return Object(i.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"shouldComponentUpdate",value:function(e,t,s){return this.props.isLoggedIn!==e.isLoggedIn||this.props.loginName!==e.loginName||this.props.photo!==e.photo}},{key:"componentDidUpdate",value:function(e,t,s){this.props.authorized()}},{key:"componentWillMount",value:function(){this.props.authorized()}},{key:"render",value:function(){return Object(b.jsx)(We,Object(r.a)({},this.props))}}]),s}(a.a.Component),He={authorized:function(){return function(e){M().then((function(t){0===t.data.resultCode&&(e(D(t.data.data.login)),e(A(t.data.data.id)),e(U(!0)),E(t.data.data.id).then((function(t){e({type:"me/SET-PHOTO",photo:t.data.photos.small})})))}))}},login:L,logout:function(){return function(e){y().then((function(t){0===t.data.resultCode&&(e(D(null)),e(U(!1)))}))}}},Ve=Object(f.b)((function(e){return{loginName:e.auth.loginName,photo:e.auth.me.photo,isLoggedIn:e.auth.isLoggedIn}}),He)(ze),Je=s(34),Ze=s.n(Je),$e=s(53),Xe=function(e){var t=e.login,s=e.isLoggedIn,n=Object($e.a)({initialValues:{email:"",password:"",rememberMe:!1},validate:function(e){var t={};return e.email?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e.email)||(t.email="Invalid email address"):t.email="Email field is required",e.password?e.password.length<3&&(t.password="\u0414\u043b\u0438\u043d\u0430 \u043f\u0430\u0440\u043e\u043b\u044f \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043c\u0435\u043d\u0435\u0435 3 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"):t.password="Password field is required",t},onSubmit:function(e){t(e)}});return s?Object(b.jsx)(O.a,{to:"/"}):Object(b.jsx)("div",{children:Object(b.jsxs)("form",{className:Ze.a.form,onSubmit:n.handleSubmit,children:[Object(b.jsxs)("label",{children:[Object(b.jsx)("input",Object(r.a)(Object(r.a)({},n.getFieldProps("email")),{},{type:"text",placeholder:"Email"})),n.errors.email&&Object(b.jsx)("div",{className:Ze.a.error,children:n.errors.email})]}),Object(b.jsxs)("label",{children:[Object(b.jsx)("input",Object(r.a)(Object(r.a)({autoComplete:""},n.getFieldProps("password")),{},{type:"password",placeholder:"Password"})),n.errors.password&&Object(b.jsx)("div",{className:Ze.a.error,children:n.errors.password})]}),Object(b.jsxs)("label",{children:[Object(b.jsx)("input",Object(r.a)(Object(r.a)({},n.getFieldProps("rememberMe")),{},{type:"checkbox"})),"RememberMe"]}),Object(b.jsx)("input",{type:"submit"})]})})},qe=s(27),Ke=s.n(qe),Qe=function(e){var t=e.totalCount,s=e.pagesSize;return Math.ceil(t/s)},Ye=function(e){var t=e.replace("T"," ").split(" "),s=Object(fe.a)(t,2),n=s[0],a=s[1],o=n.split("-");return{time:a.substring(0,8),date:"".concat(o[2]," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Des"][+o[1]-1]," ").concat(o[0])}},et=function(e){var t=Ye(e.lastUserActivityDate),s=Object(f.c)(),n=function(){var t=Object(C.a)(w.a.mark((function t(){return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s(ue(e.id,20,1));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(b.jsxs)("div",{className:"block ".concat(Ke.a.dialogsItem),children:[Object(b.jsx)("div",{className:Ke.a.image,children:Object(b.jsx)(h.b,{title:e.userName,to:"/dialogs/".concat(e.id,"/messages"),onClick:n,children:Object(b.jsx)("img",{alt:e.userName,src:e.photos.small||"https://vjoy.cc/wp-content/uploads/2020/12/1133ea1de4e69bd760056f2c04e90920.png"})})}),Object(b.jsxs)("div",{className:Ke.a.description,children:[Object(b.jsx)(h.b,{className:Ke.a.userName,title:e.userName,to:"/dialogs/messages/".concat(e.userName),onClick:n,children:e.userName}),Object(b.jsx)("div",{children:Object(b.jsx)("small",{children:Object(b.jsxs)("em",{children:[t.date," ",t.time]})})})]}),Object(b.jsx)("div",{className:Ke.a.hasNewMessages,children:e.hasNewMessages?"You have a new message!":""})]})},tt=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(){return Object(i.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"componentWillMount",value:function(){this.props.getDialogs(),this.props.getNewMessages()}},{key:"render",value:function(){return Object(b.jsx)("div",{children:this.props.dialogs.map((function(e){return Object(b.jsx)(et,Object(r.a)({},e),e.id)}))})}}]),s}(a.a.Component),st={getDialogs:function(){return function(e){X().then((function(t){e({type:"SET-DIALOGS",dialogs:t.data})}))}},getNewMessages:le},nt=Object(f.b)((function(e){return{dialogs:e.dialogsPage.dialogs}}),st)(tt),at=s(5),ot=s.n(at),ct=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(){return Object(i.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t,s){return this.props.message.senderId!==e.message.senderId||this.props.message.viewed!==e.message.viewed||this.props.isSpam!==e.isSpam}},{key:"componentWillUpdate",value:function(e,t,s){this.props.getMessages(this.props.userID,20,this.props.pageCount)}},{key:"addMessageToSpam",value:function(){this.props.message.senderId!==this.props.authorizedID&&this.props.addMessageToSpam(this.props.message.id)}},{key:"restoreMessage",value:function(){this.props.restoreMessage(this.props.message.id),this.props.getMessages(this.props.userID,20,this.props.pageCount)}},{key:"render",value:function(){var e=this,t=this.props.message.body.replace(/<br \/>/g,"\n"),s=Ye(this.props.message.addedAt),n=this.props.message.senderId===this.props.authorizedID?this.props.authorizedPhoto:this.props.photo,a=this.props.message.senderId===this.props.authorizedID?"".concat(ot.a.messageItem," ").concat(ot.a.authorized):"".concat(ot.a.messageItem);return this.props.isSpam&&(a+=" ".concat(ot.a.spam)),Object(b.jsxs)("div",{className:a,children:[Object(b.jsxs)("div",{className:ot.a.btnsBlock,children:[Object(b.jsx)("button",{className:ot.a.removeMessageBtn,onClick:this.props.isSpam?function(){}:this.addMessageToSpam.bind(this),children:"+"}),Object(b.jsx)("button",{className:ot.a.removeMessageBtn,onClick:this.props.isSpam?this.restoreMessage.bind(this):function(){return e.props.removeMessage(e.props.message.id)},children:"\u0445"})]}),Object(b.jsx)("div",{className:ot.a.image,children:Object(b.jsx)("img",{src:n||"https://vjoy.cc/wp-content/uploads/2020/12/1133ea1de4e69bd760056f2c04e90920.png"})}),Object(b.jsxs)("div",{className:ot.a.text,children:[Object(b.jsx)("h4",{className:ot.a.name,children:this.props.message.senderName}),Object(b.jsx)("div",{className:ot.a.body,children:t}),Object(b.jsx)("div",{className:ot.a.date,children:Object(b.jsxs)("small",{children:[s.time," ",s.date]})}),Object(b.jsx)("div",{className:ot.a.viewed,children:this.props.message.viewed?Object(b.jsx)("small",{children:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e"}):Object(b.jsx)("small",{children:"\u041d\u0435 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e"})})]})]},this.props.message.id)}}]),s}(a.a.Component),rt={checkIsViewedMessage:function(e){return function(t){Y(e).then((function(s){t(function(e,t){return{type:"messages/SET-VIEW",messageID:e,isViewed:t}}(e,s))}))}},getNewestMessages:function(e,t){return function(s){ne(e,t).then((function(e){console.log(e)}))}},removeMessage:function(e){return function(t){ee(e).then((function(s){t(re(e))}))}},addMessageToSpam:function(e){return function(t,s){var n=s().dialogsPage.messages.items.find((function(t){return t.id===e}));n&&te(e).then((function(s){t(function(e){return{type:"spam/ADD-TO-SPAM",message:e}}(n)),t(re(e))}))}},restoreMessage:function(e){return function(t,s){ae(e).then((function(s){t(function(e){return{type:"spam/REMOVE-FROM-SPAM",messageID:e}}(e))}))}},getMessages:ue},it=Object(f.b)((function(e){return{photo:e.profilePage.profile.photos.small,authorizedID:e.auth.me.id,authorizedPhoto:e.auth.me.photo}}),rt)(ct),ut=function(e){var t=e.className,s=Object(d.a)(e,["className"]),a=Object(n.useState)(""),o=Object(fe.a)(a,2),c=o[0],r=o[1];Object(f.c)();return Object(b.jsxs)("div",{className:t,children:[Object(b.jsx)("textarea",{onChange:function(e){r(e.currentTarget.value)},value:c,placeholder:"To write a message..."}),Object(b.jsx)("button",{onClick:function(){s.sendMessage(s.userID,c),r("")},children:"send"})]})},lt=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(e){var n;return Object(i.a)(this,s),(n=t.call(this,e)).state={pageCount:1,messages:[]},n}return Object(u.a)(s,[{key:"componentWillMount",value:function(){0!==this.props.userID&&this.props.getUserProfile(this.props.userID)}},{key:"shouldComponentUpdate",value:function(e,t,s){return this.props.userID!==e.userID||this.props.messages!==e.messages||this.state.pageCount!==t.pageCount||this.props.sectionSelect!==e.sectionSelect||this.props.spam!==e.spam}},{key:"componentWillUpdate",value:function(e,t,s){t.pageCount!==this.state.pageCount&&this.props.getMessages(this.props.userID,20,t.pageCount)}},{key:"componentWillUnmount",value:function(){this.props.clearMessages()}},{key:"showPrevMessages",value:function(){var e=this;this.setState((function(t){return e.state.pageCount<Qe({totalCount:e.props.messagesTotalCount,pagesSize:20})?Object(r.a)(Object(r.a)({},t),{},{pageCount:t.pageCount+1}):Object(r.a)(Object(r.a)({},t),{},{pageCount:t.pageCount})}))}},{key:"showNextMessages",value:function(){var e=this;this.setState((function(t){return e.state.pageCount>1?Object(r.a)(Object(r.a)({},t),{},{pageCount:t.pageCount-1}):Object(r.a)(Object(r.a)({},t),{},{pageCount:t.pageCount})}))}},{key:"onClickShowMessages",value:function(e){this.props.setSectionSelect(e),this.setState((function(e){return Object(r.a)(Object(r.a)({},e),{},{pageCount:1})}))}},{key:"render",value:function(){var e=this,t=Qe({totalCount:this.props.messagesTotalCount,pagesSize:20}),s="messages"===this.props.sectionSelect?0!==this.props.messages.length:0!==this.props.spam.length;return Object(b.jsxs)("div",{className:ot.a.messages,children:[Object(b.jsxs)("div",{className:ot.a.nav,children:[Object(b.jsx)("button",{className:"messages"===this.props.sectionSelect?ot.a.active:"",onClick:function(){e.onClickShowMessages("messages")},children:"Messages"}),Object(b.jsx)("button",{className:"spam"===this.props.sectionSelect?ot.a.active:"",onClick:function(){e.onClickShowMessages("spam")},children:"Spam"})]}),Object(b.jsxs)("div",{className:ot.a.messagesBlock,children:[this.state.pageCount<t&&s&&Object(b.jsx)("button",{className:ot.a.showPrevMessages,onClick:this.showPrevMessages.bind(this),children:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u2191"}),"messages"===this.props.sectionSelect?this.props.messages.map((function(t){return Object(b.jsx)(it,{userID:e.props.userID,pageCount:e.state.pageCount,message:t},t.id)})):"","spam"===this.props.sectionSelect?this.props.spam.map((function(t){return Object(b.jsx)(it,{userID:e.props.userID,pageCount:e.state.pageCount,isSpam:!0,message:t},t.id)})):"",this.state.pageCount>1&&s&&Object(b.jsx)("button",{className:ot.a.showNextMessages,onClick:this.showNextMessages.bind(this),children:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u2193"})]}),Object(b.jsx)(ut,{userID:this.props.userID,sendMessage:this.props.sendMessage,className:ot.a.sendField})]})}}]),s}(a.a.Component),pt={getMessages:ue,sendMessage:function(e,t){return function(s){Q(e,t).then((function(e){s({type:"messages/ADD-MESSAGE",message:e.data.data.message})}))}},getUserProfile:Z,refreshDialog:ie,clearMessages:function(){return{type:"messages/CLEAR-MESSAGES"}},setSectionSelect:function(e){return{type:"select/SET-SELECT",select:e}}},dt=Object(f.b)((function(e){return{messages:e.dialogsPage.messages.items,userID:e.dialogsPage.messages.userID,messagesTotalCount:e.dialogsPage.messages.totalCountMessages,sectionSelect:e.dialogsPage.sectionSelected,spam:e.dialogsPage.spam}}),pt)(lt),jt=function(e){Object(l.a)(s,e);var t=Object(p.a)(s);function s(){return Object(i.a)(this,s),t.apply(this,arguments)}return Object(u.a)(s,[{key:"componentWillMount",value:function(){this.props.getNewMessages()}},{key:"componentWillUpdate",value:function(){this.props.getNewMessages()}},{key:"render",value:function(){return this.props.isLoggedIn?Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)(Ve,{}),Object(b.jsxs)("div",{className:"container",children:[Object(b.jsx)(m,{newMessagesCount:this.props.newMessagesCount}),Object(b.jsx)("main",{className:"main",children:Object(b.jsxs)(O.d,{children:[Object(b.jsx)(O.b,{path:"/",element:Object(b.jsx)(Fe,{id:this.props.userID})}),Object(b.jsx)(O.b,{path:"/profile/me",element:Object(b.jsx)(Fe,{id:this.props.userID})}),Object(b.jsx)(O.b,{path:"/profile/*",element:Object(b.jsx)(Be,{})}),Object(b.jsx)(O.b,{path:"/posts",element:Object(b.jsx)(Se,{})}),Object(b.jsx)(O.b,{path:"/users",element:Object(b.jsx)(Pe,{showUsersCount:10})}),Object(b.jsx)(O.b,{path:"/follow",element:Object(b.jsx)(be,{})}),Object(b.jsx)(O.b,{path:"/login",element:Object(b.jsx)(Xe,Object(r.a)({},this.props))}),Object(b.jsx)(O.b,{path:"/dialogs",element:Object(b.jsx)(nt,{})}),Object(b.jsx)(O.b,{path:"/dialogs/messages/*",element:Object(b.jsx)(dt,{})})]})})]})]}):Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)(Ve,{}),Object(b.jsx)("div",{className:"container",children:Object(b.jsx)(Xe,Object(r.a)({},this.props))})]})}}]),s}(a.a.Component),gt={login:L,getNewMessages:le},ht=Object(f.b)((function(e){return{isLoggedIn:e.auth.isLoggedIn,userID:e.auth.me.id,newMessagesCount:e.dialogsPage.messages.newMessagesCount}}),gt)(jt),bt=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,88)).then((function(t){var s=t.getCLS,n=t.getFID,a=t.getFCP,o=t.getLCP,c=t.getTTFB;s(e),n(e),a(e),o(e),c(e)}))},mt=s(35),Ot=s(52),ft=Object(mt.b)({posts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ne,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD-POST":return[{id:5,title:t.title,text:t.text}].concat(Object(x.a)(e));case"REMOVE-POST":return e.filter((function(e){return e.id!==t.id}));case"CHANGE-TITLE":return e.map((function(e){return e.id===t.id?Object(r.a)(Object(r.a)({},e),{},{title:t.title}):e}));case"CHANGE-TEXT":return e.map((function(e){return e.id===t.id?Object(r.a)(Object(r.a)({},e),{},{text:t.text}):e}));default:return e}},usersPage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET-USERS":return Object(r.a)(Object(r.a)({},e),{},{users:t.users});case"GET-TOTAL-COUNT":return Object(r.a)(Object(r.a)({},e),{},{totalCount:t.totalCount});case"SET-PAGE-NUMBER":return Object(r.a)(Object(r.a)({},e),{},{currentPageNumber:t.currentPageNumber});case"SET-FOLLOW":return Object(r.a)(Object(r.a)({},e),{},{users:e.users.map((function(e){return t.userID===e.id?Object(r.a)(Object(r.a)({},e),{},{followed:t.isFollow}):e}))});default:return e}},profilePage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET-USER-PROFILE":return Object(r.a)(Object(r.a)({},e),{},{profile:t.userProfile});case"SET-USER-STATUS":return Object(r.a)(Object(r.a)({},e),{},{status:t.userStatus});default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"login/AUTHORIZED":return Object(r.a)(Object(r.a)({},e),{},{loginName:t.loginName});case"login/SET-LOGIN-IN":return Object(r.a)(Object(r.a)({},e),{},{isLoggedIn:t.value});case"me/SET-ID":return Object(r.a)(Object(r.a)({},e),{},{me:Object(r.a)(Object(r.a)({},e.me),{},{id:t.id})});case"me/SET-PHOTO":return Object(r.a)(Object(r.a)({},e),{},{me:Object(r.a)(Object(r.a)({},e.me),{},{photo:t.photo})});case"me/GET-FOLLOWING":return Object(r.a)(Object(r.a)({},e),{},{followings:t.users});case"me/ADD-FOLLOWINGS":return Object(r.a)(Object(r.a)({},e),{},{followings:[].concat(Object(x.a)(e.followings),[t.user])});default:return e}},dialogsPage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET-DIALOGS":return Object(r.a)(Object(r.a)({},e),{},{dialogs:Object(x.a)(t.dialogs)});case"messages/SET-MESSAGES":return Object(r.a)(Object(r.a)({},e),{},{messages:Object(r.a)(Object(r.a)({},e.messages),{},{items:t.messages})});case"messages/CLEAR-MESSAGES":return Object(r.a)(Object(r.a)({},e),{},{messages:Object(r.a)(Object(r.a)({},e.messages),{},{items:[]})});case"messages/ADD-MESSAGE":return Object(r.a)(Object(r.a)({},e),{},{messages:Object(r.a)(Object(r.a)({},e.messages),{},{items:[].concat(Object(x.a)(e.messages.items),[t.message])})});case"messages/SET-USER-ID":return Object(r.a)(Object(r.a)({},e),{},{messages:Object(r.a)(Object(r.a)({},e.messages),{},{userID:t.ID})});case"messages/SET-TOTAL-COUNT":return Object(r.a)(Object(r.a)({},e),{},{messages:Object(r.a)(Object(r.a)({},e.messages),{},{totalCountMessages:t.count})});case"messages/SET-NEW-MESSAGES-COUNT":return Object(r.a)(Object(r.a)({},e),{},{messages:Object(r.a)(Object(r.a)({},e.messages),{},{newMessagesCount:t.count})});case"messages/REMOVE=MESSAGE":return Object(r.a)(Object(r.a)({},e),{},{messages:Object(r.a)(Object(r.a)({},e.messages),{},{items:e.messages.items.filter((function(e){return e.id!==t.messageID}))})});case"select/SET-SELECT":return Object(r.a)(Object(r.a)({},e),{},{sectionSelected:t.select});case"spam/ADD-TO-SPAM":return Object(r.a)(Object(r.a)({},e),{},{spam:[].concat(Object(x.a)(e.spam),[t.message])});case"spam/REMOVE-FROM-SPAM":return Object(r.a)(Object(r.a)({},e),{},{spam:e.spam.filter((function(e){return e.id!==t.messageID}))});case"messages/SET-VIEW":return Object(r.a)(Object(r.a)({},e),{},{messages:Object(r.a)(Object(r.a)({},e.messages),{},{items:e.messages.items.map((function(e){return e.id===t.messageID?Object(r.a)(Object(r.a)({},e),{},{viewed:t.isViewed}):e}))})});default:return e}}}),xt=Object(mt.c)(ft,Object(mt.a)(Ot.a));window.store=xt,c.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(h.a,{children:Object(b.jsx)(f.a,{store:xt,children:Object(b.jsx)(ht,{})})})}),document.getElementById("root")),bt()}},[[87,1,2]]]);
//# sourceMappingURL=main.7453ec1e.chunk.js.map